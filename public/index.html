<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="description" content="OsloPuls - Din stemme i byen" />
  <title>OsloPuls</title>
  <style>
    /* Prevent flash of unstyled content */
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background-color: #f5f5f5;
    }
    #root {
      min-height: 100vh;
    }
    /* Loading spinner */
    .loading-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background-color: #f5f5f5;
    }
    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #0066cc;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <noscript>Du må aktivere JavaScript for å bruke denne appen.</noscript>
  <div id="root">
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Laster OsloPuls...</p>
    </div>
  </div>
  <script>
    // Log environment info for debugging
    console.log('OsloPuls - Environment info:', {
      userAgent: navigator.userAgent,
      location: window.location.href,
      basePath: window.location.pathname.split('/').slice(0, -1).join('/') || '/',
      timestamp: new Date().toISOString()
    });
    
    // Error handler for unhandled errors
    window.addEventListener('error', function(e) {
      console.error('Global error:', e.error, e.filename, e.lineno, e.colno);
      const root = document.getElementById('root');
      if (root && !root.querySelector('.error-container')) {
        const errorMsg = e.error ? e.error.toString() : 'Ukjent feil';
        root.innerHTML = '<div class="error-container" style="padding: 40px; text-align: center; min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center;"><h2 style="color: #d32f2f; margin-bottom: 16px;">En feil oppstod</h2><p style="margin-bottom: 8px; color: #666;">' + errorMsg + '</p><p style="margin-bottom: 24px; color: #999; font-size: 12px;">Fil: ' + (e.filename || 'ukjent') + ':' + (e.lineno || '?') + '</p><button onclick="window.location.reload()" style="padding: 12px 24px; background-color: #0066cc; color: white; border: none; border-radius: 4px; cursor: pointer;">Last på nytt</button></div>';
      }
    });
    
    // Unhandled promise rejection handler
    window.addEventListener('unhandledrejection', function(e) {
      console.error('Unhandled promise rejection:', e.reason);
      const root = document.getElementById('root');
      if (root && !root.querySelector('.error-container')) {
        const errorMsg = e.reason ? (e.reason.toString() || JSON.stringify(e.reason)) : 'Ukjent promise rejection';
        root.innerHTML = '<div class="error-container" style="padding: 40px; text-align: center; min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center;"><h2 style="color: #d32f2f; margin-bottom: 16px;">Promise feilet</h2><p style="margin-bottom: 24px; color: #666;">' + errorMsg + '</p><button onclick="window.location.reload()" style="padding: 12px 24px; background-color: #0066cc; color: white; border: none; border-radius: 4px; cursor: pointer;">Last på nytt</button></div>';
      }
    });
    
    // Check if React app loaded
    let loadCheckInterval = null;
    const checkAppLoaded = function() {
      const root = document.getElementById('root');
      if (root) {
        // Check if React has mounted (root should have more than just loading container)
        const hasReactContent = root.children.length > 1 || 
                               (root.children.length === 1 && !root.querySelector('.loading-container')) ||
                               root.querySelector('[data-reactroot]') ||
                               root.querySelector('[id^="__next"]');
        
        if (hasReactContent) {
          console.log('✅ React app loaded successfully');
          if (loadCheckInterval) {
            clearInterval(loadCheckInterval);
          }
          return true;
        }
      }
      return false;
    };
    
    // Check immediately and then every 2 seconds
    if (!checkAppLoaded()) {
      loadCheckInterval = setInterval(function() {
        if (checkAppLoaded()) {
          clearInterval(loadCheckInterval);
        }
      }, 2000);
      
      // Final check after 10 seconds
      setTimeout(function() {
        if (loadCheckInterval) {
          clearInterval(loadCheckInterval);
        }
        const root = document.getElementById('root');
        if (root && root.querySelector('.loading-container')) {
          console.error('❌ App failed to load after 10 seconds');
          console.error('Debug info:', {
            scripts: Array.from(document.scripts).map(s => s.src),
            stylesheets: Array.from(document.styleSheets).map(s => s.href),
            rootContent: root.innerHTML.substring(0, 200)
          });
          root.innerHTML = '<div class="error-container" style="padding: 40px; text-align: center; min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center;"><h2 style="color: #d32f2f; margin-bottom: 16px;">Appen lastet ikke</h2><p style="margin-bottom: 8px; color: #666;">Det ser ut til at appen ikke lastet etter 10 sekunder.</p><p style="margin-bottom: 8px; color: #999; font-size: 12px;">Sjekk browser console (F12) for detaljer.</p><p style="margin-bottom: 24px; color: #999; font-size: 12px;">URL: ' + window.location.href + '</p><button onclick="window.location.reload()" style="padding: 12px 24px; background-color: #0066cc; color: white; border: none; border-radius: 4px; cursor: pointer; margin-bottom: 8px;">Last på nytt</button><button onclick="console.log(\'Debug info:\', {scripts: Array.from(document.scripts).map(s => s.src), root: document.getElementById(\'root\')?.innerHTML.substring(0, 500)});" style="padding: 8px 16px; background-color: #666; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">Vis debug info i console</button></div>';
        }
      }, 10000);
    }
  </script>
</body>
</html>

